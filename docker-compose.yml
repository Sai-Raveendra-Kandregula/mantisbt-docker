version: "3"

services:
  web:
    # Pin the version for production usage!
    image: mantisbt:$VERSION
    container_name: mantis_web
    ports:
      - $PORT:80
    environment:
      # Set master salt, typically can be generated by `cat /dev/urandom | head -c 64 | base64`
      - MASTER_SALT=$MASTER_SALT
      # Set base email settings.
      # - EMAIL_WEBMASTER=$EMAIL_WEBMASTER
      # - EMAIL_FROM=$EMAIL_FROM
      # - EMAIL_RETURN_PATH=$EMAIL_RETURN_PATH
      # - SMTP_HOST=$SMTP_HOST
      # - SMTP_PORT=$SMTP_PORT
      # - SMTP_CONNECTION_MODE=$SMTP_CONNECTION_MODE
      # - SMTP_USERNAME=$SMTP_USERNAME
      # - SMTP_PASSWORD=$SMTP_PASSWORD

      # - MANTIS_URL=$MANTIS_URL
      # - MANTIS_URL_SHORT=$MANTIS_URL_SHORT
      # - MANTIS_CUSTOM_HEADERS=$MANTIS_CUSTOM_HEADERS
      - ENABLE_ADMIN=$ENABLE_ADMIN
      - RESTRICT_ADMIN_ACCESS=$RESTRICT_ADMIN_ACCESS
      - ADMIN_ACCESS_USERNAME=$ADMIN_ACCESS_USERNAME
      - ADMIN_ACCESS_PASSWORD=$ADMIN_ACCESS_PASSWORD

      - MYSQL_HOST=$MYSQL_HOST
      - MYSQL_DATABASE=$MYSQL_DATABASE
      - MYSQL_USER=$MYSQL_USER
      - MYSQL_PASSWORD=$MYSQL_PASSWORD
    depends_on:
      - db
    restart: always
    #network_mode: "host"

  db:
    image: mysql:8.4.0
    container_name: mantis_db
    volumes:
      - $SQL_DATA_PATH:/var/lib/mysql
    environment:
      - MYSQL_ROOT_PASSWORD=$MYSQL_ROOT_PASSWORD
      - MYSQL_DATABASE=$MYSQL_DATABASE
      - MYSQL_USER=$MYSQL_USER
      - MYSQL_PASSWORD=$MYSQL_PASSWORD
    command: ['mysqld', '--character-set-server=utf8mb4', '--collation-server=utf8mb4_unicode_ci']

